#include <iostream>
#include <dcmtk/dcmdata/dctk.h>
#include <opencv2/core.hpp>
#include <opencv2/imgcodecs.hpp>

using namespace std;
using namespace cv;

int main(int argc, char* argv[]) {
    // DICOM 파일 경로
    const char* dicomFilePath = "example.dcm";

    // DICOM 파일 로드
    DcmFileFormat fileFormat;
    if (fileFormat.loadFile(dicomFilePath).good()) {
        // DICOM 이미지 객체 생성
        DcmDataset* dataset = fileFormat.getDataset();

        // DICOM 이미지 속성 읽기
        Uint16 rows, columns, numberOfFrames;
        if (dataset->findAndGetUint16(DCM_Rows, rows).good() &&
            dataset->findAndGetUint16(DCM_Columns, columns).good() &&
            dataset->findAndGetUint16(DCM_NumberOfFrames, numberOfFrames).good()) {
            // PixelData를 담을 변수
            Uint8* pixelData = NULL;
            unsigned long pixelDataLength = 0;

            // PixelData 가져오기
            if (dataset->findAndGetUint8Array(DCM_PixelData, pixelData, &pixelDataLength).good()) {
                // DICOM 이미지를 OpenCV의 Mat으로 변환
                Mat dicomImage(rows, columns, CV_16U, pixelData);

                // 이미지 표시 (이 코드는 OpenCV가 설치되어 있어야 함)
                imshow("DICOM Image", dicomImage);
                waitKey(0);
            } else {
                cerr << "Failed to get PixelData" << endl;
                return 1;
            }
        } else {
            cerr << "Failed to get image attributes" << endl;
            return 1;
        }
    } else {
        cerr << "Failed to load DICOM file" << endl;
        return 1;
    }

    return 0;
}
