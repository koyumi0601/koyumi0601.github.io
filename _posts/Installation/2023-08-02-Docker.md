---
layout: single
title: "How to install and use Docker in Ubuntu"
categories: setup
tags: [Docker, Ubuntu, Installation]
toc: true
author_profile: false
sidebar:
    nav: "docs"
search: true
---

*Containerization platform, Container Engine*



# Work Instruction

## Install Docker

- Check docker is already installed or not

```bash
docker --version
```

- if not installed, install it

```bash
sudo apt update # update package manager
sudo apt install apt-transport-https ca-certificates curl software-properties-common # install required package
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg # Add official GPG key of docker
echo "deb [signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null # Add docker repository
sudo apt update # update package manager again
sudo apt install docker-ce # install docker
sudo systemctl start docker # start docker
sudo systemctl enable docker # set docker start when bootup
```

- Check docker status

```bash
sudo systemctl status docker # Check docker daemon is active
sudo docker ps # list docker containers which is current running
sudo docker info # docker deamon status and info
```



## Remove Docker

```bash
sudo apt purge docker-ce docker-ce-cli containerd.io # remove docker
sudo rm -rf /var/lib/docker # remove docker configuration. 
# need to backup docker related configuration before remove configuration
```



## Commands

```bash
docker images # check images list
docker build -f Dockerfile -t fun-docker . # build image
docker run -d -p 8080:8080 fun-docker # run image
docker ps # check running image
docker logs 392acbcbdaa0 # check log (image id)
docker login # login to dockerhub
docker tag fun-docker:latest koyumi0601/docker-example-dreamcoding:latest # change tag_name
docker push koyumi0601/docker-example-dreamcoding:latest # account_name/repository_name, push dockerhub
```







## Practice: dreamcoding

### Get example source code from github

- [https://github.com/dream-ellie/docker-example](https://github.com/dream-ellie/docker-example)
- dockerfile

```dockerfile
# Order by Layer0 -> Layer4
# base image
FROM node:16-alpine

# wokring directory
WORKDIR /app

# app dependencies
COPY package.json package-lock.json ./
RUN npm ci

# copy source code
COPY index.js .

# execute app command
ENTRYPOINT [ "node", "index.js" ]
```

### Build image

```bash
docker build -f Dockerfile -t fun-docker .
# -f: target dockerfile name to build 
# -t: docker image name, so-called tag
# .: required dockerfile path, so-called build context
```

![2023-08-07_11-01-docker-5]({{site.url}}/images/2023-08-02-Docker/2023-08-07_11-01-docker-5.png)

### Check images

```bash
docker images
```

![2023-08-07_11-01-docker-6]({{site.url}}/images/2023-08-02-Docker/2023-08-07_11-01-docker-6.png)

### Run image

```bash
docker run -d -p 8080:8080 fun-docker
# -d: detached terminal.
# -p: port connect between host(8080) and container(8080)
```

![2023-08-07_11-01-docker-7]({{site.url}}/images/2023-08-02-Docker/2023-08-07_11-01-docker-7.png){: width="300" height="200"}

### Check current running docker image

```bash
docker ps
```

![2023-08-07_11-01-docker-8]({{site.url}}/images/2023-08-02-Docker/2023-08-07_11-01-docker-8.png)

### Go to localhost:8080 and check application is running well

![2023-08-07_11-01-docker-9]({{site.url}}/images/2023-08-02-Docker/2023-08-07_11-01-docker-9.png)

### Check log

```bash
docker logs 392acbcbdaa0
```

### Upload image to container registry (dockerhub)

- Go to [https://hub.docker.com/](https://hub.docker.com/)
- Create repository: koyumi0601/docker-example-dreamcoding:latest
- Log-in(terminal)

```bash
docker login
```

- Change docker tag to dockerhub repository name

```bash
docker tag fun-docker:latest koyumi0601/docker-example-dreamcoding:latest # change tag_name
```

- push 

```bash
docker push koyumi0601/docker-example-dreamcoding:latest # account_name/repository_name
```

- Result

![2023-08-07_11-01-docker-10]({{site.url}}/images/2023-08-02-Docker/2023-08-07_11-01-docker-10.png)



## Practice: teddy note

### Get example source code from github

- [https://github.com/teddylee777/deepko](https://github.com/teddylee777/deepko)



## Generate docker image

### Pull docker image from dockerhub

- Go to tensorflow/tensorflow [https://hub.docker.com/r/tensorflow/tensorflow/tags](https://hub.docker.com/r/tensorflow/tensorflow/tags) (example)
- Click gray area to copy command to clipboard

![2023-08-05_10-42-docker]({{site.url}}/images/2023-08-02-Docker/2023-08-05_10-42-docker-1691199999626-3.png)

- Go to project folder and **pull** docker image

```bash
docker pull tensorflow/tensorflow:2.13.0-gpu-jupyter
```

```bash
docker pull gcr.io/kaggle-gpu-images/python:latest
```



- Generate dockerfile from pulled docker image

```dockerfile
FROM tensorflow/tensorflow:2.13.0-gpy-jupyter
FROM nvidia/cuda:11.2.1-cudnn8-devel-ubuntu18.04 AS nvidia
```









```bash
ARG BASE_TAG=staging

FROM nvidia/cuda:11.0-cudnn8-devel-ubuntu18.04 AS nvidia
FROM gcr.io/kaggle-images/python:${BAST_TAG}
ADD clean-layer.sh /tmp/clean-layer.sh

# Cuda support
COPY --from=nvidia /etc/apt/source.list.d/cuda.list /etc/apt/sources.list.d/
COPY --from=nvidia /etc/apt/sources.list.d/nvidia-ml.list /etc/apt/sources.list.d/
COPY --from=nvidia /etc/apt/trucsted.gpg /etc/apt/trusted.gpg.d/cuda.gpg

ENV CUDA_MAJOR_VERSION=11
ENV CUDA_MINOR_VERSION=0
ENV CUDA_VERSION=$CUDA_MAJOR_VERSION.$CUDA_MINOR_VERSION
LABEL com.nvidia.volumes.needed="nvidia_driver"
LABEL comp.nvidia.cuda.version="${CUDA_VERSION}"
ENV PATH=/usr/local/nvidia/bin:/usr/local/cuda/bin:/opt/bin:${PATH}
```





- **Run** docker image

```bash
```





# Reference

- 테디노트 영상 [https://www.youtube.com/watch?v=Tw7dU-9AkmU&t=305s](https://www.youtube.com/watch?v=Tw7dU-9AkmU&t=305s)
- 드림코딩 영상 [https://www.youtube.com/watch?v=LXJhA3VWXFA](https://www.youtube.com/watch?v=LXJhA3VWXFA)
- Docker docs [https://docs.docker.com/](https://docs.docker.com/)
- **TensorFlow Docker Images** (recommended) [https://hub.docker.com/r/tensorflow/tensorflow/](https://hub.docker.com/r/tensorflow/tensorflow/)

- Deeplearning Docker Image, Deepo [https://hub.docker.com/r/ufoym/deepo/](https://hub.docker.com/r/ufoym/deepo/)
- Kaggle/docker-python image [https://github.com/Kaggle/docker-python](https://github.com/Kaggle/docker-python)